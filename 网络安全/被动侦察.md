# 介绍
在这个房间里，在我们定义被动侦察和主动侦察之后，我们重点讨论与被动侦察相关的基本工具。我们将学习三个命令行工具：

- **whois查询 WHOIS 服务器**

- **nslookup查询 DNS 服务器**

- **dig查询 DNS 服务器**

我们使用whois来查询 WHOIS 记录，而我们使用nslookup和dig来查询 DNS 数据库记录。这些都是公开的记录，因此不会提醒目标。

我们还将学习两种在线服务的用法：

- **DNS垃圾箱**

- **Shodan.io**

这两项在线服务使我们能够收集有关目标的信息，而无需直接连接到目标。

# 被动侦察与主动侦察
侦察（recon）可以定义为收集目标信息的初步调查。这是统一杀伤链中在系统上获得初始立足点的第一步。我们将侦察分为：

**被动侦察**和**主动侦察**

## 被动侦察

例如：
- 从公共 DNS 服务器查找域的 DNS 记录。
- 检查与目标网站相关的招聘广告。
- 阅读有关目标公司的新闻文章。

## 主动侦察

例子：

- 连接到公司服务器之一，例如 HTTP、FTP 和 SMTP。
- 致电公司试图获取信息（社会工程）。
- 冒充修理工进入公司场所。

# Whois
WHOIS 是遵循RFC 3912规范的请求和响应协议。WHOIS 服务器在 TCP 端口 43 上侦听传入请求。域名注册商负责维护其租赁域名的 WHOIS 记录。WHOIS 服务器回复与请求的域相关的各种信息。特别有趣的是，我们可以了解到：
注册商：
- 域名是通过哪个注册商注册的？
- 注册人的联系信息：姓名、组织、地址、电话等。（除非通过隐私服务隐藏）
- 创建、更新和到期日期：域名首次注册是什么时候？上次更新是什么时候？以及什么时候需要更新？
- 名称服务器：请求哪个服务器来解析域名？

语法为：`whois 域名`

以下是实例：
```user@TryHackMe$ whois tryhackme.com
[Querying whois.verisign-grs.com]
[Redirected to whois.namecheap.com]
[Querying whois.namecheap.com]
[whois.namecheap.com]
Domain name: tryhackme.com
Registry Domain ID: 2282723194_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.namecheap.com
Registrar URL: http://www.namecheap.com
Updated Date: 2021-05-01T19:43:23.31Z
Creation Date: 2018-07-05T19:46:15.00Z
Registrar Registration Expiration Date: 2027-07-05T19:46:15.00Z
Registrar: NAMECHEAP INC
Registrar IANA ID: 1068
Registrar Abuse Contact Email: abuse@namecheap.com
Registrar Abuse Contact Phone: +1.6613102107
Reseller: NAMECHEAP INC
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Registry Registrant ID: 
Registrant Name: Withheld for Privacy Purposes
Registrant Organization: Privacy service provided by Withheld for Privacy ehf
[...]
URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/
>>> Last update of WHOIS database: 2021-08-25T14:58:29.57Z <<<
For more information on Whois status codes, please visit https://icann.org/epp
```
我们可以看到很多信息；我们将按照显示的顺序检查它们。首先，我们注意到我们被重定向到whois.namecheap.com以获取我们的信息。在这种情况下，目前namecheap.com正在维护该域名的 WHOIS 记录。此外，我们可以看到创建日期以及最后更新日期和到期日期。

接下来，我们获取有关注册商和注册人的信息。我们可以找到注册者的姓名和联系信息，除非他们使用某些隐私服务。尽管上面没有显示，但我们获得了该域的管理员和技术联系人。最后，如果我们有任何 DNS 记录要查找，我们会看到应该查询的域名服务器。

可以检查收集的信息以发现新的攻击面，例如社会工程或技术攻击。例如，根据渗透测试的范围，您可能会考虑对管理员用户的电子邮件服务器或 DNS 服务器进行攻击，假设它们归您的客户所有并且属于渗透测试的范围。

值得注意的是，由于自动化工具滥用 WHOIS 查询来获取电子邮件地址，因此许多 WHOIS 服务都采取了措施来解决这一问题。例如，他们可能会编辑电子邮件地址。此外，许多注册者订阅隐私服务，以避免他们的电子邮件地址被垃圾邮件发送者收集并保持他们的信息私密。

# nslookup 和 dig
在上一个任务中，我们使用 `WHOIS` 协议来获取有关我们正在查找的域名的各种信息。特别是，我们能够从注册商处获取 DNS 服务器。

使用`nslookup`(Name Server Look Up)查找域名的 IP 地址。您需要发出命令`nslookup DOMAIN_NAME`，例如nslookup tryhackme.com。或者，更一般地，您可以使用`nslookup OPTIONS`和`DOMAIN_NAME SERVER`. 这三个主要参数是：

OPTIONS 包含查询类型，如下表所示。例如，您可以用于AIPv4 地址和AAAAIPv6 地址。
DOMAIN_NAME 是您正在查找的域名。
SERVER是您要查询的DNS服务器。您可以选择任何本地或公共 DNS 服务器进行查询。Cloudflare 提供1.1.1.1和1.0.0.1，Google 提供8.8.8.8和8.8.4.4，Quad9 提供9.9.9.9和149.112.112.112。如果您想要替代 ISP 的 DNS 服务器，还有更多公共 DNS 服务器可供选择。
| 参数 | 结果
| --- | ---
| A | IPv4 地址
| AAAA | IPv6 地址
| CNAME |	Canonical Name
| MX | 邮件服务器
| SOA | Start of Authority
| TXT | TXT Records
